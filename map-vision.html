<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>マップ上の壁（黒線）表示</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      background: #f9f9f9;
    }
    canvas {
      margin-top: 1em;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>
  <h1>マップ画像から壁（黒線）を抽出して表示</h1>
  <input type="file" id="imageLoader" name="imageLoader" accept="image/*" />
  <br />
  <canvas id="originalCanvas"></canvas>
  <canvas id="wallsCanvas"></canvas>

  <script>
    const imageLoader = document.getElementById('imageLoader');
    const originalCanvas = document.getElementById('originalCanvas');
    const wallsCanvas = document.getElementById('wallsCanvas');
    const originalCtx = originalCanvas.getContext('2d');
    const wallsCtx = wallsCanvas.getContext('2d');

    imageLoader.addEventListener('change', handleImage, false);

    function handleImage(e) {
      const reader = new FileReader();
      reader.onload = function(event) {
        const img = new Image();
        img.onload = function() {
          originalCanvas.width = img.width;
          originalCanvas.height = img.height;
          wallsCanvas.width = img.width;
          wallsCanvas.height = img.height;

          // 元画像描画
          originalCtx.drawImage(img, 0, 0);

          // 画像データ取得
          const imageData = originalCtx.getImageData(0, 0, img.width, img.height);
          const data = imageData.data;

          // 壁のみを抽出（黒に近い色を検出）
          const wallImage = wallsCtx.createImageData(img.width, img.height);
          const wallData = wallImage.data;

          for (let i = 0; i < data.length; i += 4) {
            const r = data[i];
            const g = data[i + 1];
            const b = data[i + 2];
            const a = data[i + 3];

            // 黒線の条件（明度の低い色：黒に近い）
            if (r < 40 && g < 40 && b < 40 && a > 100) {
              wallData[i] = 255;     // 赤
              wallData[i + 1] = 0;   // 緑
              wallData[i + 2] = 0;   // 青
              wallData[i + 3] = 180; // 半透明赤
            } else {
              wallData[i + 3] = 0;   // 完全透明
            }
          }

          wallsCtx.putImageData(wallImage, 0, 0);
        };
        img.src = event.target.result;
      };
      reader.readAsDataURL(e.target.files[0]);
    }
  </script>
</body>
</html>
